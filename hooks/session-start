#!/usr/bin/env bash
set -euo pipefail

escape_for_json() {
    local s="$1"
    s="${s//\\/\\\\}"
    s="${s//\"/\\\"}"
    s="${s//$'\n'/\\n}"
    s="${s//$'\r'/\\r}"
    s="${s//$'\t'/\\t}"
    printf '%s' "$s"
}

session_context="Run /autopilot to activate autonomous project manager mode. The PM will assess the repo, plan work, implement via subagents, create PRs, and iterate through GitHub Copilot code reviews until clean."
session_escaped=$(escape_for_json "$session_context")

cat <<EOF
{
  "additional_context": "${session_escaped}",
  "hookSpecificOutput": {
    "hookEventName": "SessionStart",
    "additionalContext": "${session_escaped}"
  }
}
EOF

exit 0
